<?php

namespace App\Repositories;

use App\Http\Requests\Vulnerability\ListVulnerabilityRequest;
use App\Models\Vulnerability;
use Illuminate\Contracts\Pagination\Paginator;
use Spatie\QueryBuilder\AllowedFilter;
use Spatie\QueryBuilder\AllowedInclude;
use Spatie\QueryBuilder\QueryBuilder;

class VulnerabilityRepository extends BaseRepository {
    const ALLOWED_INCLUDES = [
        'factors',
        'user',
    ];

    public function list(ListVulnerabilityRequest $request): Paginator {
        $query = QueryBuilder::for(Vulnerability::class)
            ->allowedFilters([
                AllowedFilter::exact('user_id'),
            ])
            ->allowedIncludes(self::ALLOWED_INCLUDES);

        return $this->paginate($request, $query);
    }

    public function create(array $data): Vulnerability {
        return Vulnerability::create($data);
    }
}
