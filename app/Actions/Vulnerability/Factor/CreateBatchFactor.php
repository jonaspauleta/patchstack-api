<?php

namespace App\Actions\Vulnerability\Factor;

use App\DTOs\Vulnerability\Factor\CreateBatchFactorData;
use App\DTOs\Vulnerability\Factor\CreateFactorData;
use App\Models\Vulnerability;
use App\Repositories\FactorRepository;
use Illuminate\Support\Collection;

class CreateBatchFactor
{
    public function __construct(
        private readonly FactorRepository $factorRepository,
    ) {
    }

    public function execute(
        CreateBatchFactorData $data,
        Vulnerability $vulnerability,
    ): Collection {
        $updatedCollection = new Collection();

        foreach ($data->data as $factor) {
            $data = new CreateFactorData(
                strval($factor['name']),
                floatval($factor['value']),
            );

            $updatedCollection->add($this->factorRepository->create($data->toArray(), $vulnerability));
        }

        return $updatedCollection;
    }
}
