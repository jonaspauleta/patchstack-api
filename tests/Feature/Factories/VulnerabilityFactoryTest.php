<?php

use App\Models\User;
use App\Models\Vulnerability;

it('can create & save a vulnerability with random data', function () {
    $vulnerability = Vulnerability::factory()->create();

    $this->assertDatabaseHas('vulnerabilities', [
        'id' => $vulnerability->id,
        'user_id' => $vulnerability->user_id,
    ]);

    $this->assertNotNull($vulnerability->user_id);
});

it('can create & associate a vulnerability to the new user', function () {
    $vulnerability = Vulnerability::factory()->create();

    $this->assertDatabaseHas('vulnerabilities', [
        'id' => $vulnerability->id,
        'user_id' => $vulnerability->user_id,
    ]);

    $this->assertNotNull($vulnerability->user_id);

    $this->assertDatabaseHas('users', [
        'id' => $vulnerability->user_id,
    ]);
});

it('can create & save a vulnerability with custom data', function () {
    $user = User::factory()->create();

    $data = [
        'code' => 'code',
        'title' => 'title',
        'overview' => 'overview',
        'description' => 'description',
        'image_url' => null,
        'user_id' => $user->id,
    ];

    $vulnerability = Vulnerability::factory()->create($data);

    $this->assertNotNull($vulnerability->user_id);

    $this->assertDatabaseHas('vulnerabilities', $data);
});
